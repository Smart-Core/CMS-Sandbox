{% extends '@UnicatModule/Admin/_layout.html.twig' %}

{% block title %}{{ 'Attributes group'|trans }} &laquo;{{ group.title }}&raquo; / {{ parent() }}{% endblock %}

{% block content %}

    <a href="#showHelp" role="button" class="btn btn-small" data-toggle="modal" style="float: right; margin-top: 8px;"><b>?</b> Справка</a>
    <div id="showHelp" class="modal hide fade modal-admin" tabindex="-1" role="dialog" aria-labelledby="showHelpLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="showHelpLabel">Справка по созданию атрибута</h3>
        </div>
        <div class="modal-body">
            <table class="table table-hover">
                <tr>
                    <td style="width: 20%; white-space: nowrap;">Заголовок <em>*</em></td>
                    <td>Любой текст.</td>
                </tr>
                <tr>
                    <td>Имя <em>*</em></td>
                    <td><div class="alert alert-error"><b>Внимание!</b> Доступно только при создании атрибута.</div>
                        Только латинские буквы в нижем регистре.
                    </td>
                </tr>
                <tr>
                    <td>Тип <em>*</em></td>
                    <td><div class="alert alert-error"><b>Внимание!</b> Доступно только при создании атрибута.</div></td>
                </tr>
                <tr>
                    <td>Params yaml</td>
                    <td>
                        <p>Атрибуты формы:</p>
                        <pre>form:
    attr:
        class: 'wysiwyg'
        data-theme: 'advanced'
                        </pre>

                        <p>Для <b>image</b> можно задать фильтр:</p>
                        <pre>filter: 300_300</pre>
                    </td>
                </tr>
                <tr>
                    <td>Is dedicated table</td>
                    <td>
                        <div class="alert alert-error"><b>Внимание!</b> Доступно только при создании атрибута.</div>
                        Создать таблицу для хранения значений, которая будет служить для поиска по этому атрибуту.
                    </td>
                </tr>
                <tr>
                    <td>Is link</td>
                    <td>Создавать ссылку за запись, используется с шаблоне по умолчанию.</td>
                </tr>
                <tr>
                    <td>Is required</td>
                    <td>Обязателен для заполнения.</td>
                </tr>
                <tr>
                    <td>Is show title</td>
                    <td>Показывать заголовок атрибута, используется с шаблоне по умолчанию.</td>
                </tr>
                <tr>
                    <td>Show in admin</td>
                    <td>Показывать в таблице админа.</td>
                </tr>
                <tr>
                    <td>Show in list</td>
                    <td>Показывать пользователям в списках записей.</td>
                </tr>
                <tr>
                    <td>Show in view</td>
                    <td>Показывать пользователям при просмотре записи.</td>
                </tr>
                <tr>
                    <td>Open tag</td>
                    <td>Открывающий код.</td>
                </tr>
                <tr>
                    <td>Close tag</td>
                    <td>Закрывающий код.</td>
                </tr>
            </table>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">{{ 'Close'|trans }}</button>
        </div>
    </div>

    <h3>{{ 'Attributes group'|trans }} &laquo;{{ group.title }}&raquo;</h3>

    <table class="table table-bordered table-hover">
        <thead><tr>
            <th style="width: 1%;">id</th>
            <th>{{ 'Title'|trans }}</th>
            <th>{{ 'Name'|trans }}</th>
            <th>{{ 'Type'|trans }}</th>
            <th>{{ 'Position'|trans }}</th>
            <th>{{ 'Is enabled'|trans }}</th>
            <th>{{ 'Is required'|trans }}</th>
            <th>{{ 'Show in'|trans }}</th>
            <th>{{ 'Is dedicated table'|trans }}</th>
            <th>{{ 'Created at'|trans }}</th>
        </tr></thead>
        <tbody>
        {% for item in attributes %}
            <tr>
                <td>{{ item.id }}</td>
                <td><a href="{{ path('unicat_admin.attribute', {
                        'configuration': configuration.name,
                        'group_id': item.group.id,
                        'id': item.id,
                    }) }}">{{ item.title }}</a></td>
                <td>{{ item.name }}</td>
                <td>{{ item.type }}</td>
                <td>{{ item.position }}</td>
                <td>{{ item.isEnabled }}</td>
                <td>{{ item.isRequired }}</td>
                <td>
                    {% if item.showInAdmin %}<span class="label label-important">admin</span>{% endif %}
                    {% if item.showInList  %}<span class="label label-info">list</span>{% endif %}
                    {% if item.showInView  %}<span class="label label-warning">view</span>{% endif %}
                </td>
                <td>{{ item.isDedicatedTable }}</td>
                <td>{{ item.createdAt|date() }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {{ form(form, {'attr': {'class': 'form-horizontal well'}}) }}

    <style type="text/css" media="screen">
        .ace_editor * {
            font-family: consolas, Courier, monospace;
            font-size: 14px;
        }
        #unicat_attribute_params_yaml, #ace_params_yaml {
            font-family: consolas, Courier, monospace;
            font-size: 14px;
            width: 100%;
            height: 140px;
        }
    </style>

    <script src="{{ asset('bundles/felib/ace/ace.js') }}" type="text/javascript" charset="utf-8"></script>
    <script>
        $('#unicat_attribute_params_yaml_control_group > .controls').append('<div id="ace_params_yaml" />');

        var editor = ace.edit("ace_params_yaml");
        var textarea = $('#unicat_attribute_params_yaml').hide();
        editor.setTheme("ace/theme/github");
        editor.getSession().setMode("ace/mode/yaml");
        editor.getSession().setValue(textarea.val());
        editor.getSession().on('change', function(){
            textarea.val(editor.getSession().getValue());
        });
    </script>

{% endblock content %}
